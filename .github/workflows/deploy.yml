name: Deploy

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Version'
        required: true
        default: '1.0.0'
      branch:
        description: 'Branch'
        required: true
        default: 'master'

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2
        with:
          ref: ${{ github.event.inputs.branch }}
      - name: Build Docker Image for ScriptBeeClient
        run: |
          docker build -t dxworks/scriptbee-client:${{ github.event.inputs.version }} -f ./ScriptBeeClient/Dockerfile .
      - name: Build Docker Image for ScriptBee Backend
        run: |
          docker build -t dxworks/scriptbee-backend:${{ github.event.inputs.version }} -f ./Dockerfile .
      - name: Publish Docker Images
        run: |
          docker login -u ${{ secrets.DOCKER_USERNAME }} -p ${{ secrets.DOCKER_PASSWORD }}
          docker push dxworks/scriptbee-client:${{ github.event.inputs.version }}
          docker push dxworks/scriptbee-backend:${{ github.event.inputs.version }}
